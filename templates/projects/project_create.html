{% extends 'base_dashboard.html' %}
{% load static tailwind_tags %}

{% block title %}Cr√©er un Projet - LOPES PEINTURE{% endblock %}

{% block extra_css %}
{% tailwind_css %}
<style>
/* Estilos CSS espec√≠ficos */
.form-label {
  @apply block text-sm font-semibold text-gray-900 mb-2;
}

.form-input {
  @apply w-full px-3 py-2 border border-gray-300 rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200;
}

.form-textarea {
  @apply resize-none;
}

.form-select {
  @apply appearance-none bg-white;
}

.form-checkbox {
  @apply w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500;
}

.btn {
  @apply inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 transition-all duration-200;
}

.btn-primary {
  @apply bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500;
}

.btn-secondary {
  @apply bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200 focus:ring-gray-500;
}

.btn-success {
  @apply bg-green-600 text-white hover:bg-green-700 focus:ring-green-500;
}

.card {
  @apply bg-white rounded-xl shadow-sm border border-gray-200;
}

.flex-center {
  @apply flex items-center justify-center;
}

.animate-fade-in {
  animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-6">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Auto-save indicator -->
    <div id="auto-save-indicator" class="fixed top-4 right-4 bg-green-50 border border-green-200 text-green-800 px-4 py-2 rounded-lg text-sm opacity-0 transition-all duration-300 z-50 shadow-lg">
    <div class="flex items-center gap-2">
    <i class="fas fa-check-circle text-green-600"></i>
    <span class="font-medium">Sauvegarde automatique</span>
    </div>
    </div>

    <!-- Header Section -->
    <div class="mb-8">
    <div class="card p-6">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
    
    <!-- Title and Description -->
    <div class="flex-1">
    <div class="flex items-center gap-4 mb-3">
    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex-center shadow-lg">
    <i class="fas fa-plus-circle text-xl text-white"></i>
    </div>
    <div>
    <h1 class="text-2xl lg:text-3xl font-bold text-gray-900">
    Cr√©er un Nouveau Projet
    </h1>
    <p class="text-gray-600 mt-1">
    D√©crivez votre projet pour recevoir un devis personnalis√©
    </p>
    </div>
    </div>
    
    <!-- Info badges -->
    <div class="flex flex-wrap items-center gap-4 text-sm">
    <div class="flex items-center gap-2 text-blue-600">
    <i class="fas fa-clock w-4 h-4"></i>
    <span>5-10 minutes</span>
    </div>
    <div class="flex items-center gap-2 text-green-600">
    <i class="fas fa-save w-4 h-4"></i>
    <span>Sauvegarde auto</span>
    </div>
    <div class="flex items-center gap-2 text-purple-600">
    <i class="fas fa-shield-alt w-4 h-4"></i>
    <span>S√©curis√©</span>
    </div>
    </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row gap-3 lg:flex-shrink-0">
    <a href="{% url 'projects:list' %}" 
    class="btn btn-secondary">
    <i class="fas fa-arrow-left w-4 h-4 mr-2"></i>
    Retour √† la liste
    </a>
    
    <button type="button" 
    onclick="showHelp()"
    class="btn bg-blue-50 text-blue-700 border-blue-300 hover:bg-blue-100">
    <i class="fas fa-question-circle w-4 h-4 mr-2"></i>
    Aide
    </button>
    </div>
    </div>
    </div>
    </div>
    
    <!-- Progress Indicator -->
    <div class="card p-6 mb-8">
    <div class="flex items-center justify-between">
    
    <!-- Step 1 -->
    <div class="flex items-center step-indicator" data-step="1">
    <div class="flex items-center justify-center w-10 h-10 rounded-full bg-blue-600 text-white text-sm font-bold step-circle">
    1
    </div>
    <div class="ml-4 hidden sm:block">
    <div class="text-sm font-semibold text-blue-600">Informations g√©n√©rales</div>
    <div class="text-xs text-gray-500">Titre, type, description</div>
    </div>
    </div>

    <!-- Line 1 -->
    <div class="flex-1 h-1 mx-4 bg-gray-200 rounded-full">
    <div class="h-full bg-blue-600 rounded-full transition-all duration-500" style="width: 0%"></div>
    </div>

    <!-- Step 2 -->
    <div class="flex items-center step-indicator" data-step="2">
    <div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-600 text-sm font-bold step-circle">
    2
    </div>
    <div class="ml-4 hidden sm:block">
    <div class="text-sm font-semibold text-gray-600">D√©tails techniques</div>
    <div class="text-xs text-gray-500">Surfaces, pi√®ces, finitions</div>
    </div>
    </div>

    <!-- Line 2 -->
    <div class="flex-1 h-1 mx-4 bg-gray-200 rounded-full">
    <div class="h-full bg-blue-600 rounded-full transition-all duration-500" style="width: 0%"></div>
    </div>

    <!-- Step 3 -->
    <div class="flex items-center step-indicator" data-step="3">
    <div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-600 text-sm font-bold step-circle">
    3
    </div>
    <div class="ml-4 hidden sm:block">
    <div class="text-sm font-semibold text-gray-600">Finalisation</div>
    <div class="text-xs text-gray-500">Adresse, planning, budget</div>
    </div>
    </div>
    </div>

    <!-- Progress bar -->
    <div class="mt-6">
    <div class="w-full bg-gray-200 rounded-full h-2">
    <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-500 ease-out progress-bar" 
    style="width: 33%"></div>
    </div>
    <div class="text-sm text-gray-600 mt-2 progress-text">
    √âtape 1 sur 3 (33%)
    </div>
    </div>
    </div>

    <!-- Validation Summary -->
    <div id="validation-summary" class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6 hidden">
    <div class="flex items-center mb-3">
    <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
    <h3 class="text-sm font-semibold text-red-800">Veuillez corriger les erreurs suivantes :</h3>
    </div>
    <ul id="validation-errors" class="text-sm text-red-700 space-y-1"></ul>
    </div>

    <!-- Form Container -->
    <form method="post" id="project-wizard-form" enctype="multipart/form-data" 
    action="{% url 'projects:create' %}">
    {% csrf_token %}
    

    <!-- ==== -->
    <!-- SECTION 1: INFORMATIONS G√âN√âRALES -->
    <!-- ==== -->
    <div class="card p-6 mb-8 wizard-step active" id="step1">

    <!-- Section Header -->
    <div class="flex items-center gap-4 mb-6 pb-4 border-b border-gray-200">
    <div class="w-12 h-12 bg-blue-100 rounded-xl flex-center">
    <i class="fas fa-info-circle text-xl text-blue-600"></i>
    </div>
    <div>
    <h2 class="text-xl font-bold text-gray-900">Informations G√©n√©rales</h2>
    <p class="text-gray-600 text-sm mt-1">D√©crivez votre projet en quelques mots</p>
    </div>
    </div>

    <!-- Form Fields -->
    <div class="space-y-6">
    
    <!-- Titre -->
    <div class="form-group">
    <label for="step1-title" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-tag text-gray-400"></i>
    Nom du projet
    <span class="text-red-500">*</span>
    <button type="button" class="group relative">
    <i class="fas fa-question-circle text-gray-400 hover:text-blue-500 transition-colors"></i>
    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10">
    Donnez un titre clair et descriptif
    </div>
    </button>
    </span>
    </label>
    <div class="relative">
    <input type="text" 
    id="step1-title"
    name="title"
    class="form-input pl-10"
    placeholder="Ex: Peinture salon et cuisine"
    required>
    </div>
    {% if form.title.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.title.errors.0 }}</span>
    </div>
    {% endif %}
    <div class="mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg">
    <p class="text-xs text-blue-700">
    <i class="fas fa-lightbulb text-amber-500 mr-1"></i>
    <strong>Conseil:</strong> Soyez sp√©cifique pour faciliter l'estimation (ex: "Peinture chambre parentale 15m¬≤")
    </p>
    </div>
    </div>

    <!-- Type de projet et Priorit√© -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="form-group">
    <label for="step1-project-type" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-home text-gray-400"></i>
    Type de projet
    <span class="text-red-500">*</span>
    </span>
    </label>
    <select 
    id="step1-project-type"
    name="type_projet"
    class="form-input form-select"
    required>
    <option value="">S√©lectionnez un type</option>
    {% for value, label in form.type_projet.field.choices %}
    <option value="{{ value }}" {% if form.type_projet.value == value %}selected{% endif %}>
    {{ label }}
    </option>
    {% endfor %}
    </select>
    {% if form.type_projet.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.type_projet.errors.0 }}</span>
    </div>
    {% endif %}
    <p class="text-xs text-gray-500 mt-1">S√©lectionnez le type principal de travaux</p>
    </div>

    <div class="form-group">
    <label for="step1-project-priority" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-flag text-gray-400"></i>
    Priorit√© du projet
    </span>
    </label>
    <select 
    id="step1-project-priority"
    name="priority"
    class="form-input form-select">
    <option value="">S√©lectionnez une priorit√©</option>
    {% for value, label in form.priority.field.choices %}
    <option value="{{ value }}" {% if form.priority.value == value %}selected{% endif %}>
    {{ label }}
    </option>
    {% endfor %}
    </select>
    {% if form.priority.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.priority.errors.0 }}</span>
    </div>
    {% endif %}
    <p class="text-xs text-gray-500 mt-1">Aidez-nous √† prioriser votre demande</p>
    </div>
    </div>

    <!-- Description -->
    <div class="form-group">
    <label for="step1-description" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-align-left text-gray-400"></i>
    Description d√©taill√©e
    <span class="text-red-500">*</span>
    <button type="button" class="group relative">
    <i class="fas fa-question-circle text-gray-400 hover:text-blue-500 transition-colors"></i>
    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10">
    Plus c'est d√©taill√©, plus notre devis sera pr√©cis
    </div>
    </button>
    </span>
    </label>
    <textarea name="description"
    id="step1-description"
    rows="4"
    class="form-input form-textarea"
    placeholder="D√©crivez votre projet en d√©tail..."
    required>{{ form.description.value|default:'' }}</textarea>
    {% if form.description.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.description.errors.0 }}</span>
    </div>
    {% endif %}
    
    <!-- Description Tips -->
    <div class="mt-3 p-4 bg-blue-50 border border-blue-200 rounded-lg">
    <p class="font-semibold text-blue-900 mb-2 flex items-center gap-2">
    <i class="fas fa-lightbulb text-amber-500"></i>
    Que mentionner dans votre description :
    </p>
    <ul class="space-y-1 text-sm text-blue-800 list-disc list-inside ml-4">
    <li>L'√©tat actuel des surfaces (neuf, ancien, ab√Æm√©)</li>
    <li>Le type de peinture souhait√© (mate, satin√©e, brillante)</li>
    <li>Les couleurs envisag√©es</li>
    <li>Toute contrainte particuli√®re (animaux, enfants, d√©lais)</li>
    </ul>
    </div>
    </div>

    <!-- Types de pi√®ces -->
    <div class="form-group">
    <label class="form-label">Types de pi√®ces concern√©es</label>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
    {% if form.pieces_salon %}
    <label class="flex items-center gap-2 cursor-pointer">
    <input type="checkbox" 
    name="{{ form.pieces_salon.html_name }}" 
    id="step1-pieces-salon" 
    class="form-checkbox"
    {% if form.pieces_salon.value %}checked{% endif %}>
    <span class="text-sm">{{ form.pieces_salon.label }}</span>
    </label>
    {% endif %}
    
    {% if form.pieces_cuisine %}
    <label class="flex items-center gap-2 cursor-pointer">
    <input type="checkbox" 
    name="{{ form.pieces_cuisine.html_name }}" 
    id="step1-pieces-cuisine" 
    class="form-checkbox"
    {% if form.pieces_cuisine.value %}checked{% endif %}>
    <span class="text-sm">{{ form.pieces_cuisine.label }}</span>
    </label>
    {% endif %}

    {% if form.pieces_chambre %}
    <label class="flex items-center gap-2 cursor-pointer">
    <input type="checkbox" 
    name="{{ form.pieces_chambre.html_name }}" 
    id="step1-pieces-chambre" 
    class="form-checkbox"
    {% if form.pieces_chambre.value %}checked{% endif %}>
    <span class="text-sm">{{ form.pieces_chambre.label }}</span>
    </label>
    {% endif %}

    {% if form.pieces_salle_de_bain %}
    <label class="flex items-center gap-2 cursor-pointer">
    <input type="checkbox" 
    name="{{ form.pieces_salle_de_bain.html_name }}" 
    id="step1-pieces-salle-de-bain" 
    class="form-checkbox"
    {% if form.pieces_salle_de_bain.value %}checked{% endif %}>
    <span class="text-sm">{{ form.pieces_salle_de_bain.label }}</span>
    </label>
    {% endif %}

    {% if form.pieces_bureau %}
    <label class="flex items-center gap-2 cursor-pointer">
    <input type="checkbox" 
    name="{{ form.pieces_bureau.html_name }}" 
    id="step1-pieces-bureau" 
    class="form-checkbox"
    {% if form.pieces_bureau.value %}checked{% endif %}>
    <span class="text-sm">{{ form.pieces_bureau.label }}</span>
    </label>
    {% endif %}

    {% if form.pieces_couloir %}
    <label class="flex items-center gap-2 cursor-pointer">
    <input type="checkbox" 
    name="{{ form.pieces_couloir.html_name }}" 
    id="step1-pieces-couloir" 
    class="form-checkbox"
    {% if form.pieces_couloir.value %}checked{% endif %}>
    <span class="text-sm">{{ form.pieces_couloir.label }}</span>
    </label>
    {% endif %}
    </div>
    </div>

    <!-- Section Navigation -->
    <div class="mt-8 pt-6 border-t border-gray-200">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
    <div class="text-sm text-gray-600 order-2 sm:order-1">
    <span class="font-semibold">√âtape 1 sur 3</span> - Informations de base
    </div>
    <button type="button" 
    onclick="showStep(2)"
    id="step1-next"
    class="btn btn-primary order-1 sm:order-2">
    <span>Suivant - D√©tails techniques</span>
    <i class="fas fa-arrow-right ml-2"></i>
    </button>
    </div>
    </div>
    </div>
    </div>

    <!-- ==== -->
    <!-- SECTION 2: D√âTAILS TECHNIQUES -->
    <!-- ==== -->
    <div class="card p-6 mb-8 hidden wizard-step" id="step2">
    
    <!-- Section Header -->
    <div class="flex items-center gap-4 mb-6 pb-4 border-b border-gray-200">
    <div class="w-12 h-12 bg-blue-100 rounded-xl flex-center">
    <i class="fas fa-cogs text-xl text-blue-600"></i>
    </div>
    <div>
    <h2 class="text-xl font-bold text-gray-900">D√©tails Techniques</h2>
    <p class="text-gray-600 text-sm mt-1">Pr√©cisez les caract√©ristiques techniques</p>
    </div>
    </div>

    <div class="space-y-8">  
    <!-- Surfaces et Dimensions -->
    <div class="mt-8">

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="form-group">
    <label for="step2-surface-area" class="form-label">
    <span class="flex items-center gap-1">
    <i class="fas fa-expand-arrows-alt text-gray-400 text-xs"></i>
    Surface Totale (m¬≤)
    <span class="text-red-500">*</span>
    </span>
    </label>
    <div class="relative">
    <input type="number" 
    name="surface_totale"
    value="{{ form.surface_totale.value|default:'' }}"    
    id="step2-surface-area"
    class="form-input pl-10"
    placeholder="0.00"
    step="0.01"
    min="0"
    required>
    </div>
    {% if form.surface_totale.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.surface_totale.errors.0 }}</span>
    </div>
    {% endif %}
    </div>
    </div> 

    <!-- Calculateur de surface -->
    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
    <h4 class="font-semibold text-blue-900 mb-3 flex items-center gap-2">
    <i class="fas fa-calculator text-blue-600"></i>
    Calculateur de surface automatique
    </h4>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">

    <div class="form-group">
    <label class="block text-sm font-medium text-gray-700 mb-1">Longueur (m)</label>
    <input type="number" id="calc-length" name="length" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="5.5">
    {% if form.length.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.length.errors.0 }}</span>
    </div>
    {% endif %}
    </div>
    <div class="form-group">
    <label class="block text-sm font-medium text-gray-700 mb-1">Largeur (m)</label>
    <input type="number" id="calc-width" name="width" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="4.2">
    {% if form.width.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.width.errors.0 }}</span>
    </div>
    {% endif %}
    </div>
    <div class="form-group">
    <label class="block text-sm font-medium text-gray-700 mb-1">Hauteur (m)</label>
    <input type="number" id="calc-height" name="height" step="0.1" min="2" value="2.5" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
    {% if form.height.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.height.errors.0 }}</span>
    </div>
    {% endif %}
    </div>
    
    <button type="button" id="calc-surface" class="w-full btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
    <i class="fas fa-calculator mr-2"></i>Calculer Surface
    </button>
    </div>
    <div id="calc-result" class="text-center text-blue-600 font-semibold"></div>

    <!-- Estimation de co√ªt -->
    <div id="cost-estimate-section" class="mt-6 p-4 bg-green-50 rounded-lg">
    <h3 class="text-lg font-semibold text-green-700 mb-3">
    <i class="fas fa-euro-sign mr-2"></i>
    Estimation de Co√ªt
    </h3>
    <div id="cost-estimate" class="text-sm text-gray-600">
    Renseignez la surface pour voir l'estimation
    </div>
    </div>
    </div>    
    </div>

    <!-- D√©tails du Projet -->
    <div class="mt-8">
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
    <i class="fas fa-list-ul text-blue-600"></i>
    D√©tails du Projet
    </h3>

    <!-- Informations G√©n√©rales -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="form-group">
    <label for="step2-nombre-pieces" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-door-open text-gray-400"></i>
    Nombre de pi√®ces
    </span>
    </label>
    <input type="number" 
    name="nombre_pieces"
    id="step2-nombre-pieces"
    class="form-input"
    placeholder="Ex: 3"
    min="1">
    {% if form.nombre_pieces.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.nombre_pieces.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <!-- √âtat des surfaces -->
    <div class="form-group">
    <label for="step2-etat-surfaces" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-search text-gray-400"></i>
    √âtat des surfaces
    </span>
    </label>
    <select name="etat_support" 
    id="step2-etat-surfaces"
    class="form-input form-select">
    <option value="">S√©lectionnez l'√©tat</option>
    {% for value, label in form.etat_support.field.choices %}
    <option value="{{ value }}" {% if form.etat_support.value == value %}selected{% endif %}>
    {{ label }}
    </option>
    {% endfor %}
    </select>
    {% if form.etat_support.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.etat_support.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <!-- Type de finitions -->
    <div class="form-group">
    <label for="step2-paint-type" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-paint-roller text-gray-400"></i>
    Type de finitions
    </span>
    </label>
    <select name="type_finition" 
    id="step2-paint-type"
    class="form-input form-select">
    <option value="">S√©lectionnez les finitions</option>
    {% for value, label in form.type_finition.field.choices %}
    <option value="{{ value }}" {% if form.type_finition.value == value %}selected{% endif %}>
    {{ label }}
    </option>
    {% endfor %}
    </select>
    {% if form.type_finition.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.type_finition.errors.0 }}</span>
    </div>
    {% endif %}
    </div>
    </div>
    </div>

    <!-- Couleurs Souhait√©es -->
    <div class="mt-8">
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
    <i class="fas fa-palette text-blue-600"></i>
    Couleurs Souhait√©es
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Couleur Murs -->
    <div class="form-group">
    <label for="step2-couleur-murs" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-paint-brush text-gray-400"></i>
    {{ form.couleur_murs.label }}
    </span>
    </label>
    <div class="relative">
    <input type="text" 
    name="couleur_murs"
    value="{{ form.couleur_murs.value|default:'' }}"
    id="step2-couleur-murs" 
    class="form-input" 
    placeholder="Ex: Blanc cass√©, RAL 9010" />
    </div>
    {% if form.couleur_murs.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.couleur_murs.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <!-- Couleur Plafond -->
    <div class="form-group">
    <label for="step2-couleur-plafond" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-paint-roller text-gray-400"></i>
    {{ form.couleur_plafond.label }}
    </span>
    </label>
    <div class="relative">
    <input type="text" 
    name="couleur_plafond"
    value="{{ form.couleur_plafond.value|default:'' }}"
    id="step2-couleur-plafond" 
    class="form-input" 
    placeholder="Ex: Blanc" />
    </div>
    {% if form.couleur_plafond.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.couleur_plafond.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <!-- Couleur Boiseries -->
    <div class="form-group">
    <label for="step2-couleur-boiseries" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-paint-brush text-gray-400"></i>
    {{ form.couleur_boiseries.label }}
    </span>
    </label>
    <div class="relative">
    <input type="text" 
    name="couleur_boiseries"
    value="{{ form.couleur_boiseries.value|default:'' }}"
    id="step2-couleur-boiseries" 
    class="form-input" 
    placeholder="Ex: Blanc cass√©, RAL 9010" />
    </div>
    {% if form.couleur_boiseries.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.couleur_boiseries.errors.0 }}</span>
    </div>
    {% endif %}
    </div>
    </div>
    </div>

    <!-- Pr√©paration et Mat√©riaux -->
    <div class="mt-8">
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
    <i class="fas fa-tools text-blue-600"></i>
    Pr√©paration et Mat√©riaux
    </h3>

    <div class="space-y-6">
    <!-- Pr√©paration n√©cessaire -->
    <div class="form-group">
    <label for="step2-preparation-necessaire" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-hard-hat text-gray-400"></i>
    {{ form.preparation_necessaire.label }}
    </span>
    </label>
    <div class="relative w-full">
    <textarea name="preparation_necessaire" 
    id="step2-preparation-necessaire"
    class="form-input form-textarea"
    rows="2"
    placeholder="Pr√©paration sp√©cifique n√©cessaire...">{{ form.preparation_necessaire.value|default:'' }}</textarea>
    </div>
    {% if form.preparation_necessaire.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.preparation_necessaire.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <!-- Mat√©riaux sp√©cifiques -->
    <div class="form-group">
    <label for="step2-materiaux-specifiques" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-boxes text-gray-400"></i>
    {{ form.materiaux_specifiques.label }}
    </span>
    </label>
    <div class="relative w-full">
    <textarea name="materiaux_specifiques" 
    id="step2-materiaux-specifiques"
    class="form-input form-textarea"
    rows="2"
    placeholder="Mat√©riaux sp√©cifiques souhait√©s...">{{ form.materiaux_specifiques.value|default:'' }}</textarea>
    </div>
    {% if form.materiaux_specifiques.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.materiaux_specifiques.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <!-- Contraintes horaires -->
    <div class="form-group">
    <label for="step2-contraintes-horaires" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-clock text-gray-400"></i>
    {{ form.contraintes_horaires.label }}
    </span>
    </label>
    <div class="relative w-full">
    <textarea name="contraintes_horaires" 
    id="step2-contraintes-horaires"
    class="form-input form-textarea"
    rows="2"
    placeholder="Contraintes d'horaires particuli√®res...">{{ form.contraintes_horaires.value|default:'' }}</textarea>
    </div>
    {% if form.contraintes_horaires.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.contraintes_horaires.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <!-- Acc√®s difficile (checkbox) -->
    <div class="form-group">
    <div class="p-4 bg-orange-50 border border-orange-200 rounded-lg">
    <label class="flex items-center gap-3 cursor-pointer">
    <input type="checkbox" 
    name="acces_difficile" 
    id="step2-acces-difficile"
    class="form-checkbox"
    {% if form.acces_difficile.value %}checked{% endif %}>
    <span class="text-sm text-gray-700">
    <i class="fas fa-exclamation-triangle text-orange-500 mr-2"></i>
    <strong>Acc√®s difficile ou contraintes particuli√®res</strong>
    <div class="text-xs text-gray-600 mt-1">
    Cochez si l'acc√®s au chantier pr√©sente des difficult√©s (√©tages sans ascenseur, stationnement difficile, etc.)
    </div>
    </span>
    </label>
    {% if form.acces_difficile.errors %}
    <div class="mt-2 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.acces_difficile.errors.0 }}</span>
    </div>
    {% endif %}
    </div>
    </div>
    </div>
    </div>
    </div>

    <!-- Section Navigation -->
    <div class="mt-8 pt-6 border-t border-gray-200">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
    <button type="button" 
    onclick="showStep(1)"
    id="step2-prev"
    class="btn btn-secondary order-2 sm:order-1">
    <i class="fas fa-arrow-left mr-2"></i>
    <span>Pr√©c√©dent</span>
    </button>
    
    <div class="text-sm text-gray-600 order-3 sm:order-2">
    <span class="font-semibold">√âtape 2 sur 3</span> - D√©tails techniques
    </div>
    
    <button type="button" 
    onclick="showStep(3)"
    id="step2-next"
    class="btn btn-primary order-1 sm:order-3">
    <span>Suivant - Finalisation</span>
    <i class="fas fa-arrow-right ml-2"></i>
    </button>
    </div>
    </div>
    </div>

    <!-- ==== -->
    <!-- SECTION 3: FINALISATION -->
    <!-- ==== -->
    <div class="card p-6 mb-8 hidden wizard-step" id="step3">

    <div class="flex items-center gap-4 mb-6 pb-4 border-b border-gray-200">
    <div class="w-12 h-12 bg-blue-100 rounded-xl flex-center">
    <i class="fas fa-check-circle text-xl text-blue-600"></i>
    </div>
    <div>
    <h2 class="text-xl font-bold text-gray-900">Finalisation du Projet</h2>
    <p class="text-gray-600 text-sm mt-1">Adresse, planning et budget pour finaliser votre demande</p>
    </div>
    </div>

    <div class="space-y-8">
    
    <!-- Localisation -->
    <div>
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
    <i class="fas fa-map-marker-alt text-blue-600"></i>
    Localisation des Travaux
    </h3>

    <div class="space-y-6">
    <div class="form-group">
    <label for="step3-adresse-travaux" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-home text-gray-400"></i>
    Adresse compl√®te des travaux
    <span class="text-red-500">*</span>
    </span>
    </label>
    <div class="relative">
    <i class="absolute left-3 top-3 fas fa-map-marker-alt text-gray-400"></i>
    <textarea name="adresse_travaux" 
    id="step3-adresse-travaux"
    rows="2"
    class="form-input form-textarea pl-10"
    placeholder="Num√©ro, rue, appartement..."
    required>{{ form.adresse_travaux.value|default:'' }}</textarea>
    </div>
    {% if form.adresse_travaux.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.adresse_travaux.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="form-group">
    <label for="step3-ville" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-city text-gray-400"></i>
    Ville
    <span class="text-red-500">*</span>
    </span>
    </label>
    <div class="relative">
    <i class="absolute left-3 top-1/2 transform -translate-y-1/2 fas fa-building text-gray-400"></i>
    <input type="text" 
    name="ville" 
    value="{{ form.ville.value|default:'' }}"
    id="step3-ville"
    class="form-input pl-10"
    placeholder="Ex: Paris"
    required>
    </div>
    {% if form.ville.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.ville.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <div class="form-group">
    <label for="step3-code-postal" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-mail-bulk text-gray-400"></i>
    Code postal
    <span class="text-red-500">*</span>
    </span>
    </label>
    <div class="relative">
    <i class="absolute left-3 top-1/2 transform -translate-y-1/2 fas fa-hashtag text-gray-400"></i>
    <input type="text" 
    name="code_postal"
    value="{{ form.code_postal.value|default:'' }}"
    id="step3-code-postal"
    class="form-input pl-10"
    placeholder="Ex: 75001"
    maxlength="5"
    pattern="[0-9]{5}"
    required>
    </div>
    {% if form.code_postal.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.code_postal.errors.0 }}</span>
    </div>
    {% endif %}
    </div>
    </div>
    </div>
    </div>

    <!-- Planning -->
    <div>
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
    <i class="fas fa-calendar-alt text-blue-600"></i>
    Planning et D√©lais
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="form-group">
    <label for="step3-date-debut-souhaitee" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-calendar-day text-gray-400"></i>
    Date de d√©but souhait√©e
    </span>
    </label>
    <div class="relative">
    <i class="absolute left-3 top-1/2 transform -translate-y-1/2 fas fa-calendar text-gray-400"></i>
    <input type="date" 
    name="date_debut_souhaitee"
    value="{{ form.date_debut_souhaitee.value|default:'' }}"
    id="step3-date-debut-souhaitee"
    class="form-input pl-10">
    </div>
    {% if form.date_debut_souhaitee.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.date_debut_souhaitee.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <div class="form-group">
    <label for="step3-date-fin-souhaitee" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-calendar-check text-gray-400"></i>
    Date de fin souhait√©e
    </span>
    </label>
    <div class="relative">
    <i class="absolute left-3 top-1/2 transform -translate-y-1/2 fas fa-flag-checkered text-gray-400"></i>
    <input type="date" 
    name="date_fin_souhaitee"
    value="{{ form.date_fin_souhaitee.value|default:'' }}"
    id="step3-date-fin-souhaitee"
    class="form-input pl-10">
    </div>
    {% if form.date_fin_souhaitee.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.date_fin_souhaitee.errors.0 }}</span>
    </div>
    {% endif %}
    </div>
    </div>
    </div>

    <!-- Budget -->
    <div>
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
    <i class="fas fa-euro-sign text-blue-600"></i>
    Budget et Financement
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="form-group">
    <label for="step3-budget-minimum" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-hand-holding-usd text-gray-400"></i>
    Budget minimum (‚Ç¨)
    </span>
    </label>
    <div class="relative">
    <i class="absolute left-3 top-1/2 transform -translate-y-1/2 fas fa-euro-sign text-gray-400"></i>
    <input type="number" 
    name="budget_minimum"
    value="{{ form.budget_minimum.value|default:'' }}"
    id="step3-budget-minimum"
    class="form-input pl-10"
    placeholder="Ex: 1000"
    min="0"
    step="1">
    </div>
    {% if form.budget_minimum.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.budget_minimum.errors.0 }}</span>
    </div>
    {% endif %}
    </div>

    <div class="form-group">
    <label for="step3-budget-maximum" class="form-label">
    <span class="flex items-center gap-2">
    <i class="fas fa-coins text-gray-400"></i>
    Budget maximum (‚Ç¨)
    </span>
    </label>
    <div class="relative">
    <i class="absolute left-3 top-1/2 transform -translate-y-1/2 fas fa-euro-sign text-gray-400"></i>
    <input type="number" 
    name="budget_maximum"
    value="{{ form.budget_maximum.value|default:'' }}"
    id="step3-budget-maximum"
    class="form-input pl-10"
    placeholder="Ex: 5000"
    min="0"
    step="1">
    </div>
    {% if form.budget_maximum.errors %}
    <div class="mt-1 flex items-center gap-2 text-red-600 text-sm">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ form.budget_maximum.errors.0 }}</span>
    </div>
    {% endif %}
    </div>
    </div>
    </div>

    <!-- R√©capitulatif -->
    <div>
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
    <i class="fas fa-clipboard-check text-blue-600"></i>
    R√©capitulatif de votre Projet
    </h3>

    <div class="p-6 bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl">
    <div id="project-summary" class="space-y-4">
    <div class="text-center py-8">
    <i class="fas fa-spinner fa-spin text-2xl text-blue-600 mb-3"></i>
    <p class="text-blue-700">G√©n√©ration du r√©capitulatif en cours...</p>
    </div>
    </div>
    </div>
    </div>

    <!-- Conditions -->
    <div>
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
    <i class="fas fa-file-contract text-blue-600"></i>
    Conditions et Consentements
    </h3>

    <div class="space-y-4">
    <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
    <label class="flex items-start gap-3 cursor-pointer">
    <input type="checkbox" 
    name="accept_conditions" 
    id="step3-accept-conditions"
    value="1"
    class="form-checkbox"
    required>
    <span class="text-sm text-gray-700">
    <strong>J'accepte les conditions g√©n√©rales de service</strong> et 
    autorise LOPES PEINTURE √† me contacter concernant ce projet.
    </span>
    </label>
    </div>
    
    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
    <label class="flex items-start gap-3 cursor-pointer">
    <input type="checkbox" 
    name="newsletter" 
    id="step3-newsletter"
    value="1"
    class="form-checkbox">
    <span class="text-sm text-gray-700">
    <strong>Newsletter (optionnel)</strong> - Je souhaite recevoir des conseils et 
    offres sp√©ciales de LOPES PEINTURE.
    </span>
    </label>
    </div>
    </div>
    </div>
    </div>

    <!-- Section Navigation -->
    <div class="mt-8 pt-6 border-t border-gray-200">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
    <button type="button" 
    onclick="showStep(2)"
    id="step3-prev"
    class="btn btn-secondary order-2 sm:order-1">
    <i class="fas fa-arrow-left mr-2"></i>
    <span>Pr√©c√©dent</span>
    </button>
    
    <div class="text-sm text-gray-600 order-3 sm:order-2">
    <span class="font-semibold">√âtape 3 sur 3</span> - Finalisation
    </div>
    
    <button type="submit" 
    id="submit-project"
    class="btn btn-success order-1 sm:order-3">
    <i class="fas fa-paper-plane mr-2"></i>
    <span>Envoyer ma Demande</span>
    <script>
        document.getElementById('submit-project').addEventListener('click', function() {
            console.log('üöÄ Form submission initiated');
        });
    </script>
    </button>
    </div>
    </div>
    </div>

    </form>
    </div>
</div>

<script>
// Variables globales
let currentStep = 1;
let formData = {};

// DOM Ready
document.addEventListener('DOMContentLoaded', function() {
  console.log('üöÄ Initializing project wizard');
    initializeWizard();
    setupEventListeners();
    setupAutoSave();
    setupCalculator();
});

// Initialisation du wizard
function initializeWizard() {
    showStep(1);
    updateProgressBar(1);
    console.log('‚úÖ Wizard initialized');
}

// Configuration des √©v√©nements
function setupEventListeners() {
  console.log('‚öôÔ∏è Setting up event listeners');
    // Navigation buttons
    const form = document.getElementById('project-wizard-form');
    if (form) {
        form.addEventListener('submit', handleSubmit);
    }
    console.log('‚úÖ Form submit listener added');
    // Auto-save on field changes
    document.addEventListener('input', function(e) {
        if (e.target.matches('input, select, textarea')) {
            autoSave();
        }
    });
    console.log('‚úÖ Auto-save listener added');
}

// Gestion de la soumission du formulaire
function handleSubmit(e) {
    // Simple validation - only check if user is on final step (step 3)
    if (currentStep !== 3) {
        e.preventDefault();
        alert('Veuillez aller √† la derni√®re √©tape pour soumettre le formulaire.');
        showStep(3);
        return false;
    }
  
    // Check only critical required fields
    const title = document.getElementById('step1-title')?.value?.trim();
    const description = document.getElementById('step1-description')?.value?.trim();
    const projectType = document.getElementById('step1-project-type')?.value?.trim();
    const acceptConditions = document.getElementById('step3-accept-conditions')?.checked;
  
    if (!title || !description || !projectType || !acceptConditions) {
        e.preventDefault();
        alert('Veuillez remplir au minimum: Nom du projet, Description, Type de projet et accepter les conditions.');
        return false;
    }
  
    // Show loading indicator
    showAutoSaveIndicator('Envoi en cours...');
  
    // Allow form submission - DO NOT PREVENT DEFAULT
    return true;
}

// Affichage des √©tapes
function showStep(step) {
    // Cacher toutes les √©tapes
    document.querySelectorAll('.wizard-step').forEach(el => {
        el.classList.add('hidden');
        el.classList.remove('active');
    });
    console.log(`‚û°Ô∏è Navigating to step ${step}`);
    // Afficher l'√©tape courante
    const currentStepEl = document.getElementById(`step${step}`);
    if (currentStepEl) {
        currentStepEl.classList.remove('hidden');
        currentStepEl.classList.add('active');
    }
    
    // Mettre √† jour les variables
    currentStep = step;
    updateProgressBar(step);
    updateStepIndicators(step);
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    // Generate summary for step 3
    if (step === 3) {
        generateProjectSummary();
    }
    console.log('‚úÖ Step content updated');
}

// Mise √† jour de la barre de progression
function updateProgressBar(step) {
    const progressBar = document.querySelector('.progress-bar');
    const progressText = document.querySelector('.progress-text');
    console.log('üîÑ Updating progress bar for step:', step);
    if (progressBar && progressText) {
        const percentage = (step / 3) * 100;
        progressBar.style.width = percentage + '%';
        progressText.textContent = `√âtape ${step} sur 3 (${Math.round(percentage)}%)`;
    }
    console.log('‚úÖ Progress bar updated');
}

// Mise √† jour des indicateurs d'√©tape
function updateStepIndicators(step) {
    document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
        const stepNum = index + 1;
        const circle = indicator.querySelector('.step-circle');
        console.log(`üîÑ Updating step indicator for step ${stepNum}`);
        if (stepNum <= step) {
            circle.classList.remove('bg-gray-300', 'text-gray-600');
            circle.classList.add('bg-blue-600', 'text-white');
        } else {
            circle.classList.remove('bg-blue-600', 'text-white');
            circle.classList.add('bg-gray-300', 'text-gray-600');
        }
    });
    console.log('‚úÖ Step indicators updated');
}

// Validation de l'√©tape courante
function validateCurrentStep() {
    const currentStepEl = document.getElementById(`step${currentStep}`);
    if (!currentStepEl) return true;
    console.log('üîÑ Validating current step:', currentStep);
    const requiredFields = currentStepEl.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            isValid = false;
            field.classList.add('border-red-500');
        } else {
            field.classList.remove('border-red-500');
        }
    });
    
    return isValid;
    console.log('‚úÖ Current step validation result:', isValid);
}

// Affichage des erreurs de validation
function showValidationErrors() {
    const summary = document.getElementById('validation-summary');
    const errorsList = document.getElementById('validation-errors');
    
    if (!summary || !errorsList) return;
    
    const errors = [];
    const currentStepEl = document.getElementById(`step${currentStep}`);
    const requiredFields = currentStepEl.querySelectorAll('[required]');
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            const label = currentStepEl.querySelector(`label[for="${field.id}"]`);
            const fieldName = label ? label.textContent.replace('*', '').trim() : field.name;
            errors.push(`Le champ "${fieldName}" est obligatoire`);
        }
    });
    
    if (errors.length > 0) {
        errorsList.innerHTML = errors.map(error => `<li>‚Ä¢ ${error}</li>`).join('');
        summary.classList.remove('hidden');
    } else {
        summary.classList.add('hidden');
    }
    showAutoSaveIndicator('Sauvegard√© localement');//mudei aqui
}

// Auto-sauvegarde
function setupAutoSave() {
    setInterval(autoSave, 30000); // Save every 30 seconds
}

function autoSave() {
    collectFormData();
    localStorage.setItem('project_form_data', JSON.stringify(formData));
    showAutoSaveIndicator('Sauvegard√© automatiquement');
}

// Collecte des donn√©es du formulaire
function collectFormData() {
    const form = document.getElementById('project-wizard-form');
    if (!form) return;
    console.log('üöÄ Initializing form data collection');
    formData = {};
    const formElements = form.querySelectorAll('input, select, textarea');
    
    formElements.forEach(element => {
        if (element.name && element.name !== 'csrfmiddlewaretoken') {
            if (element.type === 'checkbox') {
                formData[element.name] = element.checked;
            } else {
                formData[element.name] = element.value;
            }
        }
    });
    
    // Update hidden fields for form submission
    updateHiddenFields();
    console.log('Form data collected:', formData);
}

// Mise √† jour des champs cach√©s
function updateHiddenFields() {
    const hiddenFields = {
        'final-title': document.getElementById('step1-title')?.value || '',
        'final-description': document.getElementById('step1-description')?.value || '',
        'final-project-type': document.getElementById('step1-project-type')?.value || '',
        'final-surface-area': document.getElementById('step2-surface-area')?.value || '',
        'final-start-date': document.getElementById('step3-date-debut-souhaitee')?.value || '',
        'final-end-date': document.getElementById('step3-date-fin-souhaitee')?.value || ''
    };
    
    Object.entries(hiddenFields).forEach(([id, value]) => {
        const field = document.getElementById(id);
        if (field) field.value = value;
    });
}

// Indicateur de sauvegarde
function showAutoSaveIndicator(message) {
    const indicator = document.getElementById('auto-save-indicator');
    if (!indicator) return;
    
    const span = indicator.querySelector('span');
    if (span) span.textContent = message;
    
    indicator.style.opacity = '1';
    setTimeout(() => {
        indicator.style.opacity = '0';
    }, 3000);
}

// Calculateur de surface
function setupCalculator() {
    const calcButton = document.getElementById('calc-surface');
    if (!calcButton) return;
    
    calcButton.addEventListener('click', function() {
        const length = parseFloat(document.getElementById('calc-length')?.value) || 0;
        const width = parseFloat(document.getElementById('calc-width')?.value) || 0;
        const height = parseFloat(document.getElementById('calc-height')?.value) || 2.5;
        
        if (length && width) {
            const surface = calculateSurface(length, width, height);
            updateSurfaceField(surface);
            showCostEstimate(surface);
        }
    });
}

function calculateSurface(length, width, height) {
    // Calculate walls surface: 2 * (length + width) * height
    const wallsSurface = 2 * (length + width) * height;
    // Calculate ceiling surface: length * width
    const ceilingSurface = length * width;
    // Total surface
    return wallsSurface + ceilingSurface;
}

function updateSurfaceField(surface) {
    const surfaceField = document.getElementById('step2-surface-area');
    const resultDiv = document.getElementById('calc-result');
    
    if (surfaceField) {
        surfaceField.value = surface.toFixed(2);
    }
    
    if (resultDiv) {
        resultDiv.textContent = `Surface calcul√©e: ${surface.toFixed(2)} m¬≤`;
    }
}

function showCostEstimate(surface) {
    const estimateDiv = document.getElementById('cost-estimate');
    if (!estimateDiv) return;
    
    // Estimation simple: 25-45‚Ç¨/m¬≤ selon le type
    const minCost = surface * 25;
    const maxCost = surface * 45;
    
    estimateDiv.innerHTML = `
        <div class="space-y-2">
            <div class="flex justify-between">
                <span>Peinture standard:</span>
                <span class="font-bold">${minCost.toFixed(0)}‚Ç¨ - ${maxCost.toFixed(0)}‚Ç¨</span>
            </div>
            <div class="text-xs text-gray-600">
                Estimation bas√©e sur ${surface.toFixed(2)}m¬≤ (25-45‚Ç¨/m¬≤)
            </div>
        </div>
    `;
}

// G√©n√©ration du r√©capitulatif
function generateProjectSummary() {
    const summaryDiv = document.getElementById('project-summary');
    if (!summaryDiv) return;
    
    collectFormData();
    
    setTimeout(() => {
        const title = formData.title || 'Projet sans titre';
        const type = getSelectText('step1-project-type') || 'Non sp√©cifi√©';
        const surface = formData.surface_totale || 'Non sp√©cifi√©e';
        const ville = formData.ville || 'Non sp√©cifi√©e';
        
        summaryDiv.innerHTML = `
            <div class="space-y-4">
                <div class="text-center mb-4">
                    <h4 class="text-lg font-bold text-blue-800">${title}</h4>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Type:</span>
                            <span class="font-semibold">${type}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Surface:</span>
                            <span class="font-semibold">${surface} m¬≤</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Ville:</span>
                            <span class="font-semibold">${ville}</span>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600">D√©but souhait√©:</span>
                            <span class="font-semibold">${formData.date_debut_souhaitee || 'Flexible'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Budget min:</span>
                            <span class="font-semibold">${formData.budget_minimum ? formData.budget_minimum + '‚Ç¨' : 'Non d√©fini'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Budget max:</span>
                            <span class="font-semibold">${formData.budget_maximum ? formData.budget_maximum + '‚Ç¨' : 'Non d√©fini'}</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }, 500);
}

// Utilitaire pour obtenir le texte d'un select
function getSelectText(id) {
    const select = document.getElementById(id);
    if (!select || !select.value) return '';
    
    const option = select.querySelector(`option[value="${select.value}"]`);
    return option ? option.textContent : '';
}

// Fonction d'aide
function showHelp() {
    alert('Aide: Remplissez les informations √©tape par √©tape. Les champs marqu√©s d\'un * sont obligatoires. Vos donn√©es sont sauvegard√©es automatiquement.');
}

// Restore saved data on load
document.addEventListener('DOMContentLoaded', function() {
    const savedData = localStorage.getItem('project_form_data');
    if (savedData) {
        try {
            formData = JSON.parse(savedData);
            // Restore form fields if needed
        } catch (e) {
            console.log('No valid saved data found');
        }
    }
});
</script>
{% endblock %}