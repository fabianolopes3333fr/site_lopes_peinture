{% extends 'base_dashboard.html' %} {% load static %} {% block title %}Cr√©er un Projet - LOPES
PEINTURE{% endblock %} {% block extra_css %}
<style>
  .form-section {
    @apply bg-white border border-gray-200 rounded-lg p-6 shadow-sm transition-all duration-300;
  }
  .form-section-header {
    @apply flex items-center gap-3 mb-6 pb-4 border-b border-gray-200;
  }
  .form-group {
    @apply mb-4;
  }
  .form-label {
    @apply block text-sm font-medium text-gray-700 mb-2;
  }
  .form-input,
  .form-select,
  .form-textarea {
    @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200;
  }
  .form-input:hover {
    @apply border-gray-400;
  }
  .form-input.error {
    @apply border-red-500 focus:ring-red-500;
  }
  .form-checkbox {
    @apply rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-offset-0;
  }
  .form-error {
    @apply text-red-600 text-sm mt-1 flex items-center gap-1;
  }
  .checkbox-grid {
    @apply grid grid-cols-2 sm:grid-cols-3 gap-3;
  }
  .checkbox-item {
    @apply flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-all duration-200 cursor-pointer;
  }
  .checkbox-item:has(input:checked) {
    @apply bg-blue-50 border-blue-500;
  }
  .progress-indicator {
    @apply flex items-center justify-between mb-8 p-4 bg-gray-50 rounded-lg;
  }
  .progress-step {
    @apply flex items-center text-sm font-medium transition-all duration-300;
  }
  .progress-step.active {
    @apply text-blue-600;
  }
  .progress-step.completed {
    @apply text-green-600;
  }
  .progress-line {
    @apply flex-1 h-1 mx-4 bg-gray-300 rounded-full overflow-hidden;
  }
  .progress-line.completed {
    @apply bg-green-500;
  }
  .progress-line.active {
    @apply bg-gradient-to-r from-green-500 to-blue-500;
  }
  .step-circle {
    @apply w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300;
  }
  .section-slide-enter {
    @apply transform translate-x-full opacity-0;
  }
  .section-slide-enter-active {
    @apply transform translate-x-0 opacity-100 transition-all duration-300;
  }
  .section-slide-exit {
    @apply transform translate-x-0 opacity-100;
  }
  .section-slide-exit-active {
    @apply transform -translate-x-full opacity-0 transition-all duration-300;
  }
  .action-btn {
    @apply px-6 py-3 rounded-lg font-medium flex items-center gap-2 transition-all duration-200 shadow-sm hover:shadow-md;
  }
  .btn-primary {
    @apply bg-blue-600 hover:bg-blue-700 text-white;
  }
  .btn-secondary {
    @apply bg-gray-200 hover:bg-gray-300 text-gray-700;
  }
  .btn-success {
    @apply bg-green-600 hover:bg-green-700 text-white;
  }
  .btn-draft {
    @apply bg-gray-600 hover:bg-gray-700 text-white;
  }
  .help-tooltip {
    @apply relative inline-block ml-1;
  }
  .help-tooltip .tooltip-text {
    @apply invisible absolute bottom-full left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs rounded py-1 px-2 opacity-0 transition-all duration-200 w-48 text-center;
  }
  .help-tooltip:hover .tooltip-text {
    @apply visible opacity-100;
  }
  .surface-calculator {
    @apply bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4;
  }
  .calculator-result {
    @apply text-lg font-bold text-blue-600;
  }
  .field-with-icon {
    @apply relative;
  }
  .field-icon {
    @apply absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400;
  }
  .field-with-icon input {
    @apply pl-10;
  }
  .validation-summary {
    @apply bg-red-50 border border-red-200 rounded-lg p-4 mb-6;
  }
  .auto-save-indicator {
    @apply fixed top-4 right-4 bg-green-100 border border-green-300 text-green-800 px-3 py-2 rounded-lg text-sm opacity-0 transition-opacity duration-300 z-50;
  }
  .auto-save-indicator.show {
    @apply opacity-100;
  }
  .section-summary {
    @apply bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6;
  }
  .required-asterisk {
    @apply text-red-500 font-bold;
  }
  .form-section-icon {
    @apply w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-xl;
  }
  .progress-percentage {
    @apply text-xs text-gray-500 mt-1;
  }
</style>
{% endblock %} {% block content %}
<div class="p-6 max-w-6xl mx-auto">
  <!-- Auto-save indicator -->
  <div id="auto-save-indicator" class="auto-save-indicator">
    <i class="fas fa-check-circle mr-1"></i>
    Sauvegarde automatique
  </div>

  <!-- Header -->
  <div class="mb-8">
    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
      <div class="flex-1">
        <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
          <div class="form-section-icon">
            <i class="fas fa-plus-circle"></i>
          </div>
          Cr√©er un Nouveau Projet
        </h1>
        <p class="text-gray-600 mt-2 text-lg">
          D√©crivez votre projet de peinture pour recevoir un devis personnalis√© et professionnel.
        </p>
        <div class="flex items-center gap-4 mt-3 text-sm text-gray-500">
          <span class="flex items-center gap-1">
            <i class="fas fa-clock"></i>
            Temps estim√©: 5-10 minutes
          </span>
          <span class="flex items-center gap-1">
            <i class="fas fa-save"></i>
            Sauvegarde automatique
          </span>
          <span class="flex items-center gap-1">
            <i class="fas fa-shield-alt"></i>
            Donn√©es s√©curis√©es
          </span>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <a
          href="{% url 'projects:list' %}"
          class="action-btn btn-secondary"
          title="Retour √† la liste des projets"
        >
          <i class="fas fa-arrow-left"></i>
          Retour √† la liste
        </a>

        <button
          type="button"
          onclick="showHelp()"
          class="action-btn btn-secondary"
          title="Aide et conseils"
        >
          <i class="fas fa-question-circle"></i>
          Aide
        </button>
      </div>
    </div>
  </div>

  <!-- Progress Indicator -->
  <div class="progress-indicator">
    <div class="flex items-center w-full">
      <!-- Step 1 -->
      <div class="progress-step active" id="step-1">
        <div class="step-circle bg-blue-600 text-white" id="circle-1">1</div>
        <div class="ml-3">
          <div class="font-medium">Informations g√©n√©rales</div>
          <div class="text-xs text-gray-500">Titre, type, description</div>
        </div>
      </div>

      <div class="progress-line" id="line-1"></div>

      <!-- Step 2 -->
      <div class="progress-step" id="step-2">
        <div class="step-circle bg-gray-300 text-gray-600" id="circle-2">2</div>
        <div class="ml-3">
          <div class="font-medium">D√©tails techniques</div>
          <div class="text-xs text-gray-500">Surfaces, pi√®ces, finitions</div>
        </div>
      </div>

      <div class="progress-line" id="line-2"></div>

      <!-- Step 3 -->
      <div class="progress-step" id="step-3">
        <div class="step-circle bg-gray-300 text-gray-600" id="circle-3">3</div>
        <div class="ml-3">
          <div class="font-medium">Finalisation</div>
          <div class="text-xs text-gray-500">Adresse, planning, budget</div>
        </div>
      </div>
    </div>

    <!-- Progress bar -->
    <div class="w-full bg-gray-200 rounded-full h-2 mt-4">
      <div
        class="bg-blue-600 h-2 rounded-full transition-all duration-500"
        id="progress-bar"
        style="width: 33%"
      ></div>
    </div>
    <div class="progress-percentage" id="progress-text">√âtape 1 sur 3 (33%)</div>
  </div>

  <!-- Formul√°rio -->
  <form method="post" id="project-form" class="space-y-8" novalidate>
    {% csrf_token %}

    <!-- ================================ -->
    <!-- SECTION 1: INFORMATIONS G√âN√âRALES -->
    <!-- ================================ -->
    <div class="form-section" id="section-1">
      <div class="form-section-header">
        <div class="form-section-icon">
          <i class="fas fa-info-circle"></i>
        </div>
        <div>
          <h2 class="text-xl font-semibold text-gray-900">Informations G√©n√©rales</h2>
          <p class="text-sm text-gray-600 mt-1">D√©crivez votre projet en quelques mots</p>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Titre -->
        <div class="form-group lg:col-span-2">
          <label for="{{ form.title.id_for_label }}" class="form-label">
            <i class="fas fa-tag text-gray-400 mr-2"></i>
            Titre du projet <span class="required-asterisk">*</span>
            <div class="help-tooltip">
              <i class="fas fa-question-circle text-gray-400 cursor-help"></i>
              <span class="tooltip-text">
                Donnez un titre clair et descriptif (ex: "Peinture salon et cuisine")
              </span>
            </div>
          </label>
          <div class="field-with-icon">
            <i class="field-icon fas fa-edit"></i>
            {{ form.title }}
          </div>
          {% if form.title.errors %}
          <div class="form-error">
            <i class="fas fa-exclamation-triangle"></i>
            {{ form.title.errors.0 }}
          </div>
          {% endif %}
          <p class="text-xs text-gray-500 mt-1">
            <i class="fas fa-lightbulb text-yellow-500 mr-1"></i>
            Conseil: Soyez sp√©cifique pour faciliter l'estimation (ex: "Peinture chambre parentale
            15m¬≤")
          </p>
        </div>

        <!-- Type de projet -->
        <div class="form-group">
          <label for="{{ form.type_projet.id_for_label }}" class="form-label">
            <i class="fas fa-home text-gray-400 mr-2"></i>
            Type de projet <span class="required-asterisk">*</span>
          </label>
          {{ form.type_projet }} {% if form.type_projet.errors %}
          <div class="form-error">
            <i class="fas fa-exclamation-triangle"></i>
            {{ form.type_projet.errors.0 }}
          </div>
          {% endif %}
          <p class="text-xs text-gray-500 mt-1">S√©lectionnez le type principal de travaux</p>
        </div>

        <!-- Priorit√© -->
        <div class="form-group">
          <label for="{{ form.priority.id_for_label }}" class="form-label">
            <i class="fas fa-flag text-gray-400 mr-2"></i>
            Priorit√© du projet
          </label>
          {{ form.priority }} {% if form.priority.errors %}
          <div class="form-error">
            <i class="fas fa-exclamation-triangle"></i>
            {{ form.priority.errors.0 }}
          </div>
          {% endif %}
          <p class="text-xs text-gray-500 mt-1">Aidez-nous √† prioriser votre demande</p>
        </div>

        <!-- Description -->
        <div class="form-group lg:col-span-2">
          <label for="{{ form.description.id_for_label }}" class="form-label">
            <i class="fas fa-align-left text-gray-400 mr-2"></i>
            Description d√©taill√©e <span class="required-asterisk">*</span>
            <div class="help-tooltip">
              <i class="fas fa-question-circle text-gray-400 cursor-help"></i>
              <span class="tooltip-text">
                Plus votre description est d√©taill√©e, plus notre devis sera pr√©cis
              </span>
            </div>
          </label>
          {{ form.description }} {% if form.description.errors %}
          <div class="form-error">
            <i class="fas fa-exclamation-triangle"></i>
            {{ form.description.errors.0 }}
          </div>
          {% endif %}
          <div class="mt-2 text-xs text-gray-500">
            <div class="bg-blue-50 border border-blue-200 rounded p-3">
              <p class="font-medium text-blue-800 mb-2">
                üí° Que mentionner dans votre description :
              </p>
              <ul class="space-y-1 text-blue-700">
                <li>‚Ä¢ L'√©tat actuel des surfaces (neuf, ancien, ab√Æm√©)</li>
                <li>‚Ä¢ Le type de peinture souhait√© (mate, satin√©e, brillante)</li>
                <li>‚Ä¢ Les couleurs envisag√©es</li>
                <li>‚Ä¢ Toute contrainte particuli√®re (animaux, enfants, d√©lais)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Section Navigation -->
      <div class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
        <div class="text-sm text-gray-600">
          <span class="font-medium">√âtape 1 sur 3</span> - Informations de base
        </div>
        <button
          type="button"
          onclick="nextSection(2)"
          class="action-btn btn-primary"
          id="next-btn-1"
        >
          Suivant - D√©tails techniques
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>

    <!-- ================================ -->
    <!-- SECTION 2: D√âTAILS TECHNIQUES -->
    <!-- ================================ -->
    <div class="form-section hidden" id="section-2">
      <div class="form-section-header">
        <div class="form-section-icon">
          <i class="fas fa-cogs"></i>
        </div>
        <div>
          <h2 class="text-xl font-semibold text-gray-900">D√©tails Techniques</h2>
          <p class="text-sm text-gray-600 mt-1">
            Pr√©cisez les caract√©ristiques techniques de votre projet
          </p>
        </div>
      </div>

      <!-- Surfaces et Dimensions -->
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
          <i class="fas fa-ruler-combined text-blue-600"></i>
          Surfaces et Dimensions
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- Surface totale -->
          <div class="form-group">
            <label for="{{ form.surface_totale.id_for_label }}" class="form-label">
              <i class="fas fa-expand-arrows-alt text-gray-400 mr-1"></i>
              Surface totale (m¬≤) <span class="required-asterisk">*</span>
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-square"></i>
              {{ form.surface_totale }}
            </div>
            {% if form.surface_totale.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.surface_totale.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Surface murs -->
          <div class="form-group">
            <label for="{{ form.surface_murs.id_for_label }}" class="form-label">
              <i class="fas fa-grip-lines-vertical text-gray-400 mr-1"></i>
              Surface murs (m¬≤)
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-border-style"></i>
              {{ form.surface_murs }}
            </div>
            {% if form.surface_murs.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.surface_murs.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Surface plafond -->
          <div class="form-group">
            <label for="{{ form.surface_plafond.id_for_label }}" class="form-label">
              <i class="fas fa-grip-lines text-gray-400 mr-1"></i>
              Surface plafond (m¬≤)
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-minus"></i>
              {{ form.surface_plafond }}
            </div>
            {% if form.surface_plafond.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.surface_plafond.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Hauteur sous plafond -->
          <div class="form-group">
            <label for="{{ form.hauteur_sous_plafond.id_for_label }}" class="form-label">
              <i class="fas fa-arrows-alt-v text-gray-400 mr-1"></i>
              Hauteur (m)
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-ruler-vertical"></i>
              {{ form.hauteur_sous_plafond }}
            </div>
            {% if form.hauteur_sous_plafond.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.hauteur_sous_plafond.errors.0 }}
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Calculateur de surface -->
        <div class="surface-calculator">
          <h4 class="font-medium text-blue-800 mb-3 flex items-center gap-2">
            <i class="fas fa-calculator"></i>
            Calculateur de surface automatique
          </h4>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
            <input
              type="number"
              id="calc-longueur"
              placeholder="Longueur (m)"
              class="form-input text-sm"
              step="0.1"
            />
            <input
              type="number"
              id="calc-largeur"
              placeholder="Largeur (m)"
              class="form-input text-sm"
              step="0.1"
            />
            <input
              type="number"
              id="calc-hauteur"
              placeholder="Hauteur (m)"
              class="form-input text-sm"
              step="0.1"
              value="2.5"
            />
            <button
              type="button"
              onclick="calculateSurface()"
              class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm font-medium"
            >
              <i class="fas fa-equals mr-1"></i>
              Calculer
            </button>
          </div>
          <div class="bg-white border border-blue-300 rounded p-3">
            <div class="grid grid-cols-3 gap-4 text-sm">
              <div>
                <span class="text-gray-600">Surface sol:</span>
                <div class="calculator-result" id="result-sol">0 m¬≤</div>
              </div>
              <div>
                <span class="text-gray-600">Surface murs:</span>
                <div class="calculator-result" id="result-murs">0 m¬≤</div>
              </div>
              <div>
                <span class="text-gray-600">Surface plafond:</span>
                <div class="calculator-result" id="result-plafond">0 m¬≤</div>
              </div>
            </div>
            <button
              type="button"
              onclick="applySurfaceCalculation()"
              class="mt-3 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm font-medium"
              id="apply-calculation"
              style="display: none"
            >
              <i class="fas fa-check mr-1"></i>
              Appliquer ces valeurs
            </button>
          </div>
        </div>
      </div>

      <!-- Pi√®ces -->
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
          <i class="fas fa-door-open text-blue-600"></i>
          Pi√®ces concern√©es
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Nombre de pi√®ces -->
          <div class="form-group">
            <label for="{{ form.nombre_pieces.id_for_label }}" class="form-label">
              <i class="fas fa-hashtag text-gray-400 mr-1"></i>
              Nombre de pi√®ces <span class="required-asterisk">*</span>
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-list-ol"></i>
              {{ form.nombre_pieces }}
            </div>
            {% if form.nombre_pieces.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.nombre_pieces.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Types de pi√®ces -->
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-th-list text-gray-400 mr-1"></i>
              Types de pi√®ces
            </label>
            <div class="checkbox-grid">
              <label class="checkbox-item">
                {{ form.pieces_salon }}
                <span class="text-sm font-medium">
                  <i class="fas fa-couch mr-1 text-gray-500"></i>
                  {{ form.pieces_salon.label }}
                </span>
              </label>

              <label class="checkbox-item">
                {{ form.pieces_cuisine }}
                <span class="text-sm font-medium">
                  <i class="fas fa-utensils mr-1 text-gray-500"></i>
                  {{ form.pieces_cuisine.label }}
                </span>
              </label>

              <label class="checkbox-item">
                {{ form.pieces_chambre }}
                <span class="text-sm font-medium">
                  <i class="fas fa-bed mr-1 text-gray-500"></i>
                  {{ form.pieces_chambre.label }}
                </span>
              </label>

              <label class="checkbox-item">
                {{ form.pieces_salle_de_bain }}
                <span class="text-sm font-medium">
                  <i class="fas fa-bath mr-1 text-gray-500"></i>
                  {{ form.pieces_salle_de_bain.label }}
                </span>
              </label>

              <label class="checkbox-item">
                {{ form.pieces_bureau }}
                <span class="text-sm font-medium">
                  <i class="fas fa-desktop mr-1 text-gray-500"></i>
                  {{ form.pieces_bureau.label }}
                </span>
              </label>

              <label class="checkbox-item">
                {{ form.pieces_couloir }}
                <span class="text-sm font-medium">
                  <i class="fas fa-route mr-1 text-gray-500"></i>
                  {{ form.pieces_couloir.label }}
                </span>
              </label>

              <label class="checkbox-item">
                {{ form.pieces_exterieur }}
                <span class="text-sm font-medium">
                  <i class="fas fa-tree mr-1 text-gray-500"></i>
                  {{ form.pieces_exterieur.label }}
                </span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- √âtat et Finitions -->
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
          <i class="fas fa-palette text-blue-600"></i>
          √âtat et Finitions
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- √âtat du support -->
          <div class="form-group">
            <label for="{{ form.etat_support.id_for_label }}" class="form-label">
              <i class="fas fa-search text-gray-400 mr-1"></i>
              √âtat du support <span class="required-asterisk">*</span>
            </label>
            {{ form.etat_support }} {% if form.etat_support.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.etat_support.errors.0 }}
            </div>
            {% endif %}
            <p class="text-xs text-gray-500 mt-1">
              L'√©tat des surfaces influence le prix et les techniques utilis√©es
            </p>
          </div>

          <!-- Type de finition -->
          <div class="form-group">
            <label for="{{ form.type_finition.id_for_label }}" class="form-label">
              <i class="fas fa-sparkles text-gray-400 mr-1"></i>
              Type de finition <span class="required-asterisk">*</span>
            </label>
            {{ form.type_finition }} {% if form.type_finition.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.type_finition.errors.0 }}
            </div>
            {% endif %}
            <p class="text-xs text-gray-500 mt-1">
              Mate: aspect velout√© ‚Ä¢ Satin√©e: l√©g√®rement brillante ‚Ä¢ Brillante: tr√®s r√©fl√©chissante
            </p>
          </div>

          <!-- Pr√©paration n√©cessaire -->
          <div class="form-group md:col-span-2">
            <label for="{{ form.preparation_necessaire.id_for_label }}" class="form-label">
              <i class="fas fa-tools text-gray-400 mr-1"></i>
              Pr√©paration n√©cessaire
            </label>
            {{ form.preparation_necessaire }} {% if form.preparation_necessaire.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.preparation_necessaire.errors.0 }}
            </div>
            {% endif %}
            <p class="text-xs text-gray-500 mt-1">
              D√©crivez les travaux de pr√©paration n√©cessaires (pon√ßage, rebouchage, etc.)
            </p>
          </div>
        </div>
      </div>

      <!-- Couleurs -->
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
          <i class="fas fa-paint-brush text-blue-600"></i>
          Couleurs souhait√©es
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Couleur murs -->
          <div class="form-group">
            <label for="{{ form.couleur_murs.id_for_label }}" class="form-label">
              <i class="fas fa-square text-gray-400 mr-1"></i>
              Couleur des murs
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-palette"></i>
              {{ form.couleur_murs }}
            </div>
            {% if form.couleur_murs.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.couleur_murs.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Couleur plafond -->
          <div class="form-group">
            <label for="{{ form.couleur_plafond.id_for_label }}" class="form-label">
              <i class="fas fa-minus text-gray-400 mr-1"></i>
              Couleur du plafond
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-palette"></i>
              {{ form.couleur_plafond }}
            </div>
            {% if form.couleur_plafond.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.couleur_plafond.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Couleur boiseries -->
          <div class="form-group">
            <label for="{{ form.couleur_boiseries.id_for_label }}" class="form-label">
              <i class="fas fa-border-style text-gray-400 mr-1"></i>
              Couleur des boiseries
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-palette"></i>
              {{ form.couleur_boiseries }}
            </div>
            {% if form.couleur_boiseries.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.couleur_boiseries.errors.0 }}
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Aide couleurs -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4">
          <h4 class="font-medium text-yellow-800 mb-2 flex items-center gap-2">
            <i class="fas fa-lightbulb"></i>
            Conseils couleurs
          </h4>
          <div class="text-sm text-yellow-700 space-y-1">
            <p>‚Ä¢ Vous pouvez indiquer un nom de couleur (ex: "Blanc cass√©", "Bleu marine")</p>
            <p>‚Ä¢ Un code couleur si vous l'avez (ex: "RAL 9010", "NCS S 2020-B")</p>
            <p>‚Ä¢ Ou simplement "√Ä d√©finir" - nous vous conseillerons</p>
          </div>
        </div>
      </div>

      <!-- Mat√©riaux et Contraintes -->
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
          <i class="fas fa-hammer text-blue-600"></i>
          Mat√©riaux et Contraintes
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Mat√©riaux sp√©cifiques -->
          <div class="form-group">
            <label for="{{ form.materiaux_specifiques.id_for_label }}" class="form-label">
              <i class="fas fa-flask text-gray-400 mr-1"></i>
              Mat√©riaux sp√©cifiques
            </label>
            {{ form.materiaux_specifiques }} {% if form.materiaux_specifiques.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.materiaux_specifiques.errors.0 }}
            </div>
            {% endif %}
            <p class="text-xs text-gray-500 mt-1">Peintures √©cologiques, anti-humidit√©, etc.</p>
          </div>

          <!-- Contraintes horaires -->
          <div class="form-group">
            <label for="{{ form.contraintes_horaires.id_for_label }}" class="form-label">
              <i class="fas fa-clock text-gray-400 mr-1"></i>
              Contraintes horaires
            </label>
            {{ form.contraintes_horaires }} {% if form.contraintes_horaires.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.contraintes_horaires.errors.0 }}
            </div>
            {% endif %}
            <p class="text-xs text-gray-500 mt-1">Horaires pr√©f√©r√©s, jours √† √©viter, etc.</p>
          </div>

          <!-- Acc√®s difficile -->
          <div class="form-group md:col-span-2">
            <label class="checkbox-item">
              {{ form.acces_difficile }}
              <span class="text-sm font-medium">
                <i class="fas fa-exclamation-triangle text-orange-500 mr-1"></i>
                Acc√®s difficile ou contraintes particuli√®res
              </span>
            </label>
            {% if form.acces_difficile.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.acces_difficile.errors.0 }}
            </div>
            {% endif %}
            <p class="text-xs text-gray-500 mt-2 ml-8">
              √âtage √©lev√© sans ascenseur, parking difficile, etc.
            </p>
          </div>
        </div>
      </div>

      <!-- Section Navigation -->
      <div class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
        <button type="button" onclick="prevSection(1)" class="action-btn btn-secondary">
          <i class="fas fa-arrow-left"></i>
          Pr√©c√©dent - Informations g√©n√©rales
        </button>

        <div class="text-sm text-gray-600">
          <span class="font-medium">√âtape 2 sur 3</span> - D√©tails techniques
        </div>

        <button
          type="button"
          onclick="nextSection(3)"
          class="action-btn btn-primary"
          id="next-btn-2"
        >
          Suivant - Finalisation
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>

    <!-- ================================ -->
    <!-- SECTION 3: FINALISATION -->
    <!-- ================================ -->
    <div class="form-section hidden" id="section-3">
      <div class="form-section-header">
        <div class="form-section-icon">
          <i class="fas fa-map-marker-alt"></i>
        </div>
        <div>
          <h2 class="text-xl font-semibold text-gray-900">Finalisation</h2>
          <p class="text-sm text-gray-600 mt-1">Derniers d√©tails pour finaliser votre demande</p>
        </div>
      </div>

      <!-- Adresse -->
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
          <i class="fas fa-home text-blue-600"></i>
          Adresse des travaux
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Adresse principale -->
          <div class="form-group md:col-span-2">
            <label for="{{ form.adresse_travaux.id_for_label }}" class="form-label">
              <i class="fas fa-map-marker-alt text-gray-400 mr-1"></i>
              Adresse des travaux <span class="required-asterisk">*</span>
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-home"></i>
              {{ form.adresse_travaux }}
            </div>
            {% if form.adresse_travaux.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.adresse_travaux.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Compl√©ment d'adresse -->
          <div class="form-group">
            <label for="{{ form.complement_adresse.id_for_label }}" class="form-label">
              <i class="fas fa-plus-circle text-gray-400 mr-1"></i>
              Compl√©ment d'adresse
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-building"></i>
              {{ form.complement_adresse }}
            </div>
            {% if form.complement_adresse.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.complement_adresse.errors.0 }}
            </div>
            {% endif %}
            <p class="text-xs text-gray-500 mt-1">B√¢timent, √©tage, appartement, etc.</p>
          </div>

          <!-- Code postal -->
          <div class="form-group">
            <label for="{{ form.code_postal.id_for_label }}" class="form-label">
              <i class="fas fa-mail-bulk text-gray-400 mr-1"></i>
              Code postal <span class="required-asterisk">*</span>
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-hashtag"></i>
              {{ form.code_postal }}
            </div>
            {% if form.code_postal.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.code_postal.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Ville -->
          <div class="form-group">
            <label for="{{ form.ville.id_for_label }}" class="form-label">
              <i class="fas fa-city text-gray-400 mr-1"></i>
              Ville <span class="required-asterisk">*</span>
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-map-pin"></i>
              {{ form.ville }}
            </div>
            {% if form.ville.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.ville.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Pays -->
          <div class="form-group">
            <label for="{{ form.pays.id_for_label }}" class="form-label">
              <i class="fas fa-flag text-gray-400 mr-1"></i>
              Pays
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-globe"></i>
              {{ form.pays }}
            </div>
            {% if form.pays.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.pays.errors.0 }}
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Contact -->
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
          <i class="fas fa-user text-blue-600"></i>
          Contact sur site
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Nom du contact -->
          <div class="form-group">
            <label for="{{ form.contact_nom.id_for_label }}" class="form-label">
              <i class="fas fa-user text-gray-400 mr-1"></i>
              Nom du contact
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-id-card"></i>
              {{ form.contact_nom }}
            </div>
            {% if form.contact_nom.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.contact_nom.errors.0 }}
            </div>
            {% endif %}
            <p class="text-xs text-gray-500 mt-1">Personne √† contacter sur le chantier</p>
          </div>

          <!-- T√©l√©phone du contact -->
          <div class="form-group">
            <label for="{{ form.contact_telephone.id_for_label }}" class="form-label">
              <i class="fas fa-phone text-gray-400 mr-1"></i>
              T√©l√©phone du contact
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-mobile-alt"></i>
              {{ form.contact_telephone }}
            </div>
            {% if form.contact_telephone.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.contact_telephone.errors.0 }}
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Dates -->
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
          <i class="fas fa-calendar text-blue-600"></i>
          Planning souhait√©
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Date de d√©but -->
          <div class="form-group">
            <label for="{{ form.date_debut_souhaitee.id_for_label }}" class="form-label">
              <i class="fas fa-calendar-plus text-gray-400 mr-1"></i>
              Date de d√©but souhait√©e
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-play"></i>
              {{ form.date_debut_souhaitee }}
            </div>
            {% if form.date_debut_souhaitee.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.date_debut_souhaitee.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Date de fin -->
          <div class="form-group">
            <label for="{{ form.date_fin_souhaitee.id_for_label }}" class="form-label">
              <i class="fas fa-calendar-check text-gray-400 mr-1"></i>
              Date de fin souhait√©e
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-stop"></i>
              {{ form.date_fin_souhaitee }}
            </div>
            {% if form.date_fin_souhaitee.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.date_fin_souhaitee.errors.0 }}
            </div>
            {% endif %}
          </div>
        </div>

        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
          <p class="text-sm text-blue-700">
            <i class="fas fa-info-circle mr-1"></i>
            Ces dates sont indicatives. Nous vous proposerons un planning d√©finitif apr√®s √©tude de
            votre projet.
          </p>
        </div>
      </div>

      <!-- Budget -->
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
          <i class="fas fa-euro-sign text-blue-600"></i>
          Budget estim√©
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Budget minimum -->
          <div class="form-group">
            <label for="{{ form.budget_minimum.id_for_label }}" class="form-label">
              <i class="fas fa-arrow-down text-gray-400 mr-1"></i>
              Budget minimum (‚Ç¨)
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-euro-sign"></i>
              {{ form.budget_minimum }}
            </div>
            {% if form.budget_minimum.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.budget_minimum.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Budget maximum -->
          <div class="form-group">
            <label for="{{ form.budget_maximum.id_for_label }}" class="form-label">
              <i class="fas fa-arrow-up text-gray-400 mr-1"></i>
              Budget maximum (‚Ç¨)
            </label>
            <div class="field-with-icon">
              <i class="field-icon fas fa-euro-sign"></i>
              {{ form.budget_maximum }}
            </div>
            {% if form.budget_maximum.errors %}
            <div class="form-error">
              <i class="fas fa-exclamation-triangle"></i>
              {{ form.budget_maximum.errors.0 }}
            </div>
            {% endif %}
          </div>
        </div>

        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mt-4">
          <h4 class="font-medium text-green-800 mb-2">
            <i class="fas fa-calculator mr-1"></i>
            Estimation rapide
          </h4>
          <div class="text-sm text-green-700">
            <p class="mb-2">Prix indicatifs pour la peinture int√©rieure :</p>
            <ul class="space-y-1 ml-4">
              <li>‚Ä¢ Peinture standard : 15-25‚Ç¨/m¬≤</li>
              <li>‚Ä¢ Peinture haute qualit√© : 25-40‚Ç¨/m¬≤</li>
              <li>‚Ä¢ Avec pr√©paration importante : +10-15‚Ç¨/m¬≤</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Notes -->
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
          <i class="fas fa-sticky-note text-blue-600"></i>
          Notes et commentaires
        </h3>

        <div class="form-group">
          <label for="{{ form.notes_client.id_for_label }}" class="form-label">
            <i class="fas fa-comment text-gray-400 mr-1"></i>
            Remarques et demandes sp√©cifiques
          </label>
          {{ form.notes_client }} {% if form.notes_client.errors %}
          <div class="form-error">
            <i class="fas fa-exclamation-triangle"></i>
            {{ form.notes_client.errors.0 }}
          </div>
          {% endif %}
          <div class="mt-2 text-xs text-gray-500">
            <div class="bg-gray-50 border border-gray-200 rounded p-3">
              <p class="font-medium text-gray-700 mb-2">üí¨ Vous pouvez mentionner :</p>
              <ul class="space-y-1 text-gray-600">
                <li>‚Ä¢ Pr√©sence d'animaux domestiques</li>
                <li>‚Ä¢ Contraintes particuli√®res (bruit, poussi√®re)</li>
                <li>‚Ä¢ Pr√©f√©rences pour l'organisation du chantier</li>
                <li>‚Ä¢ Questions sp√©cifiques</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- R√©capitulatif -->
      <div class="section-summary">
        <h4 class="font-medium text-gray-900 mb-3 flex items-center gap-2">
          <i class="fas fa-list-check"></i>
          R√©capitulatif de votre projet
        </h4>
        <div id="project-summary" class="text-sm text-gray-600 space-y-2">
          <!-- Le contenu sera g√©n√©r√© par JavaScript -->
        </div>
      </div>

      <!-- Section Navigation -->
      <div class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
        <button type="button" onclick="prevSection(2)" class="action-btn btn-secondary">
          <i class="fas fa-arrow-left"></i>
          Pr√©c√©dent - D√©tails techniques
        </button>

        <div class="text-sm text-gray-600">
          <span class="font-medium">√âtape 3 sur 3</span> - Finalisation
        </div>

        <div class="flex gap-3">
          <button
            type="submit"
            name="save_draft"
            class="action-btn btn-draft"
            title="Sauvegarder en brouillon pour continuer plus tard"
          >
            <i class="fas fa-save"></i>
            Sauvegarder brouillon
          </button>
          <button type="submit" class="action-btn btn-success" id="final-submit">
            <i class="fas fa-paper-plane"></i>
            Envoyer ma demande
          </button>
        </div>
      </div>
    </div>

    <!-- Validation Summary (hidden par d√©faut) -->
    <div id="validation-summary" class="validation-summary hidden">
      <div class="flex items-center mb-3">
        <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
        <h3 class="text-sm font-medium text-red-800">Veuillez corriger les erreurs suivantes :</h3>
      </div>
      <ul id="validation-errors" class="text-sm text-red-700 space-y-1"></ul>
    </div>

    <!-- Erreurs globales -->
    {% if form.non_field_errors %}
    <div class="validation-summary">
      <div class="flex items-center mb-3">
        <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
        <h3 class="text-sm font-medium text-red-800">Erreurs de validation</h3>
      </div>
      <div class="text-sm text-red-700">{{ form.non_field_errors }}</div>
    </div>
    {% endif %}
  </form>
</div>

<!-- Help Modal -->
<div id="help-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-lg max-w-2xl w-full max-h-screen overflow-y-auto">
      <div class="p-6 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-900">Guide de cr√©ation de projet</h3>
          <button type="button" onclick="closeHelp()" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
      </div>
      <div class="p-6 space-y-6">
        <!-- Contenu du help modal sera ici -->
        <div class="space-y-4">
          <div>
            <h4 class="font-medium text-gray-900 mb-2">üìù √âtape 1: Informations g√©n√©rales</h4>
            <p class="text-sm text-gray-600">
              D√©crivez clairement votre projet. Plus vous √™tes pr√©cis, plus notre devis sera adapt√©.
            </p>
          </div>
          <div>
            <h4 class="font-medium text-gray-900 mb-2">üîß √âtape 2: D√©tails techniques</h4>
            <p class="text-sm text-gray-600">
              Les surfaces et l'√©tat des supports sont cruciaux pour estimer le co√ªt et la dur√©e.
            </p>
          </div>
          <div>
            <h4 class="font-medium text-gray-900 mb-2">üìç √âtape 3: Finalisation</h4>
            <p class="text-sm text-gray-600">
              L'adresse nous permet d'√©valuer les frais de d√©placement et la faisabilit√©.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    let currentSection = 1;
    const totalSections = 3;

    // ================================
    // NAVIGATION ENTRE SECTIONS
    // ================================

    window.nextSection = function (sectionNumber) {
      if (validateCurrentSection()) {
        showSection(sectionNumber);
      }
    };

    window.prevSection = function (sectionNumber) {
      showSection(sectionNumber);
    };

    function showSection(sectionNumber) {
      // Masquer toutes les sections
      for (let i = 1; i <= totalSections; i++) {
        const section = document.getElementById(`section-${i}`);
        section.classList.add('hidden');
      }

      // Afficher la section demand√©e
      const targetSection = document.getElementById(`section-${sectionNumber}`);
      targetSection.classList.remove('hidden');

      // Mettre √† jour le progress indicator
      updateProgressIndicator(sectionNumber);

      // Mettre √† jour la section courante
      currentSection = sectionNumber;

      // Scroll smooth vers le haut
      window.scrollTo({
        top: 0,
        behavior: 'smooth',
      });

      // Auto-save si pas la premi√®re section
      if (sectionNumber > 1) {
        autoSave();
      }

      // G√©n√©rer le r√©capitulatif si section 3
      if (sectionNumber === 3) {
        generateSummary();
      }
    }

    function updateProgressIndicator(activeSection) {
      const steps = document.querySelectorAll('.progress-step');
      const lines = document.querySelectorAll('.progress-line');

      // Mettre √† jour les steps
      steps.forEach((step, index) => {
        const stepNumber = index + 1;
        const circle = step.querySelector('.step-circle');

        // Reset classes
        step.classList.remove('active', 'completed');
        circle.classList.remove('bg-blue-600', 'bg-green-600', 'bg-gray-300');
        circle.classList.remove('text-white', 'text-gray-600');

        if (stepNumber < activeSection) {
          // Section compl√©t√©e
          step.classList.add('completed');
          circle.classList.add('bg-green-600', 'text-white');
          circle.innerHTML = '<i class="fas fa-check"></i>';
        } else if (stepNumber === activeSection) {
          // Section active
          step.classList.add('active');
          circle.classList.add('bg-blue-600', 'text-white');
          circle.textContent = stepNumber;
        } else {
          // Section pas encore visit√©e
          circle.classList.add('bg-gray-300', 'text-gray-600');
          circle.textContent = stepNumber;
        }
      });

      // Mettre √† jour les lignes de progression
      lines.forEach((line, index) => {
        line.classList.remove('completed', 'active');
        if (index + 1 < activeSection) {
          line.classList.add('completed');
        } else if (index + 1 === activeSection - 1) {
          line.classList.add('active');
        }
      });

      // Mettre √† jour la barre de progression
      const progressBar = document.getElementById('progress-bar');
      const progressText = document.getElementById('progress-text');
      const percentage = Math.round((activeSection / totalSections) * 100);

      progressBar.style.width = percentage + '%';
      progressText.textContent = `√âtape ${activeSection} sur ${totalSections} (${percentage}%)`;
    }

    // ================================
    // VALIDATION DES SECTIONS
    // ================================

    function validateCurrentSection() {
      const section = document.getElementById(`section-${currentSection}`);
      const requiredFields = section.querySelectorAll(
        'input[required], select[required], textarea[required]'
      );
      const errors = [];
      let isValid = true;

      // Reset erreurs pr√©c√©dentes
      document.querySelectorAll('.form-input.error').forEach((field) => {
        field.classList.remove('error');
      });

      // Validation des champs requis
      requiredFields.forEach((field) => {
        if (!field.value.trim()) {
          field.classList.add('error');
          isValid = false;
          errors.push(field.previousElementSibling.innerText);
        }
      });

      // Afficher r√©sum√© des erreurs si invalide
      if (!isValid) {
        showValidationSummary(errors);
      } else {
        hideValidationSummary();
      }

      return isValid;
    }

    // Afficher r√©sum√© des erreurs
    function showValidationSummary(errors) {
      const summary = document.getElementById('validation-summary');
      const errorsList = document.getElementById('validation-errors');

      // R√©initialiser la liste des erreurs
      errorsList.innerHTML = '';

      // Ajouter chaque erreur √† la liste
      errors.forEach((error) => {
        const li = document.createElement('li');
        li.className = 'flex items-start gap-2';
        li.innerHTML = `<i class="fas fa-exclamation-triangle text-red-500 mt-1"></i> ${error}`;
        errorsList.appendChild(li);
      });

      // Afficher le r√©sum√©
      summary.classList.remove('hidden');
      summary.scrollIntoView({ behavior: 'smooth' });
    }

    // Cacher le r√©sum√© des erreurs
    function hideValidationSummary() {
      const summary = document.getElementById('validation-summary');
      summary.classList.add('hidden');
    }

    // ================================
    // AUTO-SAVE DRAFT
    // ================================

    function autoSave() {
      const formData = new FormData(document.getElementById('project-form'));
      formData.append('auto_save', '1');

      fetch(document.getElementById('project-form').action, {
        method: 'POST',
        body: formData,
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
      })
        .then((response) => {
          if (response.ok) {
            showAutoSaveIndicator();
          }
        })
        .catch((error) => {
          console.log('Auto-save failed:', error);
        });
    }

    // Afficher l'indicateur de sauvegarde automatique
    function showAutoSaveIndicator() {
      const indicator = document.getElementById('auto-save-indicator');
      indicator.classList.add('show');

      setTimeout(() => {
        indicator.classList.remove('show');
      }, 3000);
    }

    // ================================
    // G√âN√âRATION DU R√âCAPITULATIF
    // ================================

    function generateSummary() {
      const summaryContainer = document.getElementById('project-summary');
      summaryContainer.innerHTML = ''; // R√©initialiser le contenu

      // R√©cup√©rer les valeurs des formulaires
      const title = document.getElementById('{{ form.title.id_for_label }}').value;
      const typeProjet = document.getElementById('{{ form.type_projet.id_for_label }}').value;
      const priority = document.getElementById('{{ form.priority.id_for_label }}').value;
      const description = document.getElementById('{{ form.description.id_for_label }}').value;
      const surfaceTotale = document.getElementById('{{ form.surface_totale.id_for_label }}').value;
      const surfaceMurs = document.getElementById('{{ form.surface_murs.id_for_label }}').value;
      const surfacePlafond = document.getElementById(
        '{{ form.surface_plafond.id_for_label }}'
      ).value;
      const hauteurSousPlafond = document.getElementById(
        '{{ form.hauteur_sous_plafond.id_for_label }}'
      ).value;
      const nombrePieces = document.getElementById('{{ form.nombre_pieces.id_for_label }}').value;
      const typeFinition = document.getElementById('{{ form.type_finition.id_for_label }}').value;
      const preparationNecessaire = document.getElementById(
        '{{ form.preparation_necessaire.id_for_label }}'
      ).value;
      const couleurMurs = document.getElementById('{{ form.couleur_murs.id_for_label }}').value;
      const couleurPlafond = document.getElementById(
        '{{ form.couleur_plafond.id_for_label }}'
      ).value;
      const couleurBoiseries = document.getElementById(
        '{{ form.couleur_boiseries.id_for_label }}'
      ).value;
      const materiauxSpecifiques = document.getElementById(
        '{{ form.materiaux_specifiques.id_for_label }}'
      ).value;
      const contraintesHoraires = document.getElementById(
        '{{ form.contraintes_horaires.id_for_label }}'
      ).value;
      const accesDifficile = document.getElementById('{{ form.acces_difficile.id_for_label }}')
        .checked
        ? 'Oui'
        : 'Non';
      const adresseTravaux = document.getElementById(
        '{{ form.adresse_travaux.id_for_label }}'
      ).value;
      const complementAdresse = document.getElementById(
        '{{ form.complement_adresse.id_for_label }}'
      ).value;
      const codePostal = document.getElementById('{{ form.code_postal.id_for_label }}').value;
      const ville = document.getElementById('{{ form.ville.id_for_label }}').value;
      const pays = document.getElementById('{{ form.pays.id_for_label }}').value;
      const contactNom = document.getElementById('{{ form.contact_nom.id_for_label }}').value;
      const contactTelephone = document.getElementById(
        '{{ form.contact_telephone.id_for_label }}'
      ).value;
      const dateDebutSouhaitee = document.getElementById(
        '{{ form.date_debut_souhaitee.id_for_label }}'
      ).value;
      const dateFinSouhaitee = document.getElementById(
        '{{ form.date_fin_souhaitee.id_for_label }}'
      ).value;
      const budgetMinimum = document.getElementById('{{ form.budget_minimum.id_for_label }}').value;
      const budgetMaximum = document.getElementById('{{ form.budget_maximum.id_for_label }}').value;
      const notesClient = document.getElementById('{{ form.notes_client.id_for_label }}').value;

      // Cr√©er un objet avec les donn√©es
      const projectData = {
        title,
        typeProjet,
        priority,
        description,
        surfaceTotale,
        surfaceMurs,
        surfacePlafond,
        hauteurSousPlafond,
        nombrePieces,
        typeFinition,
        preparationNecessaire,
        couleurMurs,
        couleurPlafond,
        couleurBoiseries,
        materiauxSpecifiques,
        contraintesHoraires,
        accesDifficile,
        adresseTravaux,
        complementAdresse,
        codePostal,
        ville,
        pays,
        contactNom,
        contactTelephone,
        dateDebutSouhaitee,
        dateFinSouhaitee,
        budgetMinimum,
        budgetMaximum,
        notesClient,
      };

      // G√©n√©rer le HTML du r√©capitulatif
      let summaryHTML = `
          <div class="font-medium text-gray-900">R√©sum√© de votre projet</div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
        `;

      // Ajouter chaque champ au r√©capitulatif
      for (const [key, value] of Object.entries(projectData)) {
        if (value) {
          summaryHTML += `
              <div class="flex flex-col">
                <span class="text-gray-600 text-sm">${key
                  .replace(/([A-Z])/g, ' $1')
                  .replace(/^./, function (str) {
                    return str.toUpperCase();
                  })}:</span>
                <span class="font-medium text-gray-900">${value}</span>
              </div>
            `;
        }
      }

      summaryHTML += `
            </div>
            <div class="mt-4 text-sm text-gray-500">
              Merci de v√©rifier que toutes les informations sont correctes avant d'envoyer votre demande.
            </div>
          `;

      // Ins√©rer le HTML dans le conteneur
      summaryContainer.innerHTML = summaryHTML;
    }

    // ================================
    // CALCUL DES SURFACES
    // ================================

    const surfaceTotale = document.getElementById('{{ form.surface_totale.id_for_label }}');
    const surfaceMurs = document.getElementById('{{ form.surface_murs.id_for_label }}');
    const surfacePlafond = document.getElementById('{{ form.surface_plafond.id_for_label }}');
    const hauteur = document.getElementById('{{ form.hauteur_sous_plafond.id_for_label }}');
    const nombrePieces = document.getElementById('{{ form.nombre_pieces.id_for_label }}');

    function calculateSurfaces() {
      const total = parseFloat(surfaceTotale.value) || 0;
      const pieces = parseInt(nombrePieces.value) || 1;
      const h = parseFloat(hauteur.value) || 2.5;

      if (total > 0) {
        // Estimation approximative
        if (!surfacePlafond.value) {
          surfacePlafond.value = total.toFixed(2);
        }

        if (!surfaceMurs.value) {
          // Estimation: p√©rim√®tre approximatif * hauteur
          const perimeter = Math.sqrt(total) * 4; // Approximation pour une pi√®ce carr√©e
          surfaceMurs.value = (perimeter * h).toFixed(2);
        }
      }
    }

    if (surfaceTotale) {
      surfaceTotale.addEventListener('blur', calculateSurfaces);
      hauteur.addEventListener('blur', calculateSurfaces);
    }

    // Form validation on submit
    const form = document.getElementById('project-form');
    form.addEventListener('submit', function (e) {
      if (currentSection !== 3) {
        e.preventDefault();
        alert('Veuillez compl√©ter toutes les sections du formulaire.');
        return;
      }

      // Show loading
      const submitBtns = form.querySelectorAll('button[type="submit"]');
      submitBtns.forEach((btn) => {
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Cr√©ation en cours...';
      });
    });

    // Auto-save draft every 5 minutes
    setInterval(function () {
      const formData = new FormData(form);
      formData.append('auto_save', '1');

      fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
      })
        .then((response) => {
          if (response.ok) {
            console.log('Auto-save successful');
          }
        })
        .catch((error) => {
          console.log('Auto-save failed:', error);
        });
    }, 300000); // 5 minutes
  });
</script>
{% endblock %}
