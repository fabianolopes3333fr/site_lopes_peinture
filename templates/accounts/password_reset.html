{% extends 'accounts/base_auth.html' %}
{% load static %}

{% block title %}Mot de passe oublié - Lopes Peinture{% endblock %}

{% block content %}
<div class="text-center mb-8">
  <!-- <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-gradient-to-br from-brand-primary to-brand-secondary mb-6 shadow-lg">
    <i class="fas fa-key text-white text-3xl"></i>
  </div> -->

  <h2 class="text-3xl font-bold text-gray-900 mb-3">Mot de passe oublié ?</h2>
  <p class="text-gray-600 text-lg max-w-md mx-auto">
    Entrez votre adresse email et nous vous enverrons un lien pour réinitialiser votre mot de passe.
  </p>
</div>

<!-- Messages d'alerte -->
{% if messages %}
  {% for message in messages %}
    <div class="mb-6 p-4 rounded-xl border-l-4 {% if message.tags == 'error' %}bg-red-50 border-red-400 text-red-700{% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-400 text-yellow-700{% elif message.tags == 'info' %}bg-blue-50 border-blue-400 text-blue-700{% else %}bg-green-50 border-green-400 text-green-700{% endif %}" role="alert">
      <div class="flex items-start">
        <div class="flex-shrink-0">
          {% if message.tags == 'error' %}
            <i class="fas fa-exclamation-triangle text-red-500 text-lg"></i>
          {% elif message.tags == 'warning' %}
            <i class="fas fa-exclamation-circle text-yellow-500 text-lg"></i>
          {% elif message.tags == 'info' %}
            <i class="fas fa-info-circle text-blue-500 text-lg"></i>
          {% else %}
            <i class="fas fa-check-circle text-green-500 text-lg"></i>
          {% endif %}
        </div>
        <div class="ml-3 flex-1">
          <p class="font-medium">{{ message }}</p>
        </div>
      </div>
    </div>
  {% endfor %}
{% endif %}

<!-- Formulário de reset de senha -->
<form method="post" class="space-y-6" id="password-reset-form" novalidate autocomplete="on">
  {% csrf_token %}

  <!-- Campo Email -->
  <div class="space-y-2">
    <label for="{{ form.email.id_for_label }}" class="block text-sm font-semibold text-gray-700">
      <i class="fas fa-envelope mr-2 text-brand-primary"></i>
      Adresse email
    </label>

    <div class="relative">
      <input
        type="email"
        id="{{ form.email.id_for_label }}"
        name="{{ form.email.html_name }}"
        value="{{ form.email.value|default:'' }}"
        placeholder="votre.email@exemple.com"
        autocomplete="email"
        required
        class="form-input w-full px-4 py-3 text-gray-900 bg-white border-2 border-gray-300 rounded-xl shadow-sm placeholder-gray-500 focus:outline-none focus:ring-0 focus:border-brand-primary transition-all duration-200 {% if form.email.errors %}error{% endif %}"
        aria-describedby="{% if form.email.errors %}{{ form.email.id_for_label }}-error{% endif %}"
      />

      <div class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
        <i class="fas fa-at text-gray-400 text-sm"></i>
      </div>
    </div>

    {% if form.email.errors %}
      <div
        id="{{ form.email.id_for_label }}-error"
        class="flex items-center text-sm text-red-600 mt-2"
        role="alert"
      >
        <i class="fas fa-exclamation-circle mr-2 flex-shrink-0"></i>
        <div>
          {% for error in form.email.errors %}
            <span class="block font-medium">{{ error }}</span>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {% if form.email.help_text %}
      <p class="text-sm text-gray-600 mt-1">{{ form.email.help_text }}</p>
    {% endif %}
  </div>

  <!-- Bouton de soumission -->
  <button
    type="submit"
    class="btn-primary w-full flex justify-center items-center py-4 px-6 text-white font-semibold text-base rounded-xl shadow-lg hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-brand-primary focus:ring-opacity-50 disabled:opacity-60 disabled:cursor-not-allowed transition-all duration-200"
    id="submit-button"
  >
    <i class="fas fa-paper-plane mr-3 text-lg"></i>
    <span id="submit-text">Envoyer le lien de réinitialisation</span>
  </button>
</form>

<!-- Liens de navigation -->
<div class="mt-8 space-y-4 text-center">
  <div class="relative">
    <div class="absolute inset-0 flex items-center" aria-hidden="true">
      <div class="w-full border-t border-gray-300"></div>
    </div>
    <div class="relative flex justify-center text-sm">
      <span class="px-4 bg-gray-50 text-gray-500 font-medium">Ou</span>
    </div>
  </div>

  <div class="space-y-3">
    <p class="text-sm text-gray-600">
      Vous vous souvenez de votre mot de passe ?
      <a
        href="{% url 'accounts:login' %}"
        class="font-semibold text-brand-primary hover:text-brand-secondary focus:outline-none focus:underline transition-colors duration-200"
      >
        Se connecter
      </a>
    </p>

    <p class="text-sm text-gray-600">
      Pas encore de compte ?
      <a
        href="{% url 'accounts:register' %}"
        class="font-semibold text-brand-primary hover:text-brand-secondary focus:outline-none focus:underline transition-colors duration-200"
      >
        Créer un compte
      </a>
    </p>
  </div>
</div>

<!-- Informations de sécurité -->
<div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-xl">
  <div class="flex items-start">
    <div class="flex-shrink-0">
      <i class="fas fa-shield-alt text-blue-500 text-lg"></i>
    </div>
    <div class="ml-3">
      <h3 class="text-sm font-semibold text-blue-800 mb-1">Sécurité</h3>
      <p class="text-sm text-blue-700">
        Le lien de réinitialisation sera valide pendant 24 heures et ne peut être utilisé qu'une seule fois.
      </p>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('password-reset-form');
  const submitButton = document.getElementById('submit-button');
  const submitText = document.getElementById('submit-text');

  if (form && submitButton) {
    form.addEventListener('submit', function() {
      submitButton.disabled = true;
      submitText.textContent = 'Envoi en cours...';
      
      // Adicionar spinner
      const spinner = document.createElement('i');
      spinner.className = 'fas fa-spinner fa-spin mr-3 text-lg';
      submitButton.querySelector('i').replaceWith(spinner);
    });
  }
});
</script>
{% endblock %}